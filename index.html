<script>
// ⭐ 무채색 (흰색, 검은색, 중간 회색) 적용 ⭐
const colors = ['#FFFFFF', '#000000', '#808080']; // 흰색, 검은색, 회색
const board = document.getElementById('gameBoard');
const comboDisplay = document.getElementById('comboCount');
const eventImage = document.getElementById('eventImage');

let combo = 0;
let highScore = 0;
let lastMoveTime = Date.now();
let grid = [];

// GitHub 저장소 이름 'DULMUNGBLAST' 적용 완료
const REPO_PATH = '/DULMUNGBLAST/'; 

function createBoard() {
    grid = [];
    board.innerHTML = '';
    for (let y = 0; y < 9; y++) {
        const row = [];
        // 보드 생성 오류 수정 완료
        for (let x = 0; x < 8; x++) { 
            const block = document.createElement('div');
            block.className = 'block';
            
            // ⭐ 문제 해결: 블록의 배경색이 무작위로 선택되도록 수정 ⭐
            block.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)]; 
            
            block.draggable = true;
            block.dataset.x = x;
            block.dataset.y = y;
            board.appendChild(block);
            row.push(block);
        }
        grid.push(row);
    }
}
createBoard();

// 드래그 앤 드롭
let selected = null;
board.addEventListener('dragstart', e => selected = e.target);
board.addEventListener('dragover', e => e.preventDefault());
board.addEventListener('drop', e => {
    if (selected && e.target.classList.contains('block') && selected !== e.target) {
        
        // ⭐ 문제 해결: style.background 대신 style.backgroundColor 사용 ⭐
        const temp = selected.style.backgroundColor; 
        selected.style.backgroundColor = e.target.style.backgroundColor;
        e.target.style.backgroundColor = temp;
        
        combo++;
        comboDisplay.textContent = combo;
        lastMoveTime = Date.now();
        
        // 경로 수정 적용
        showEvent('행복.png'); // 콤보 이벤트 이미지
        if (combo > highScore) {
            highScore = combo;
            showEvent('신남.png'); // 신기록 이미지
        }
    }
});

// 30초 무활동 시 "잠.png"
setInterval(() => {
    if (Date.now() - lastMoveTime > 30000) {
        // 경로 수정 적용
        showEvent('잠.png');
    }
}, 5000);

// 게임 오버 테스트용 (랜덤 확률로 발생)
setInterval(() => {
    if (Math.random() < 0.02) { // 확률적으로 게임 오버
        combo = 0;
        comboDisplay.textContent = combo;
        // 경로 수정 적용
        showEvent('추움.png');
    }
}, 2000);

// 이미지 표시 함수
function showEvent(filename) {
    // GitHub Pages 환경을 위해 저장소 경로를 사용합니다.
    eventImage.src = REPO_PATH + filename;
    eventImage.style.opacity = 1;
    setTimeout(() => eventImage.style.opacity = 0, 2000);
}
</script>
