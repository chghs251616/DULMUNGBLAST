<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DULMUNG BLAST üí†</title>
<style>
  body {
    margin: 0;
    background: linear-gradient(135deg, #fefefe, #e6f4f1);
    font-family: "Noto Sans KR", sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    height: 100vh;
    overflow: hidden;
    user-select: none;
  }

  h1 {
    color: #81c784;
    margin: 10px 0;
    font-weight: 800;
    text-shadow: 1px 1px 2px #ffffff;
  }

  #scoreboard {
    display: flex;
    justify-content: center;
    gap: 20px;
    font-size: 1.1em;
    color: #4b5563;
  }

  #game {
    display: grid;
    grid-template-columns: repeat(9, 40px);
    grid-template-rows: repeat(8, 40px);
    gap: 4px;
    background: #dceefb;
    border-radius: 10px;
    padding: 8px;
    box-shadow: 0 0 12px rgba(0,0,0,0.1);
    margin-top: 10px;
  }

  .cell {
    width: 40px;
    height: 40px;
    background: #f1faff;
    border-radius: 6px;
    transition: background 0.2s;
  }

  .filled {
    background: var(--color);
    box-shadow: inset 0 0 6px rgba(0,0,0,0.15);
  }

  #bottom {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 25px;
    margin-top: auto;
    margin-bottom: 25px;
  }

  .piece {
    display: inline-grid;
    gap: 4px;
    cursor: grab;
  }

  .block {
    width: 28px;
    height: 28px;
    border-radius: 5px;
    background: var(--color);
    transition: transform 0.15s;
  }

  .block:active {
    transform: scale(0.95);
  }

  /* Î∞òÏßùÏù¥Îäî Ïï†ÎãàÎ©îÏù¥ÏÖò */
  @keyframes sparkle {
    0% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(1.2); }
    100% { opacity: 0; transform: scale(1.4); }
  }

  .sparkle {
    position: absolute;
    width: 10px;
    height: 10px;
    background: radial-gradient(circle, #fff, transparent);
    border-radius: 50%;
    pointer-events: none;
    animation: sparkle 0.6s ease-out forwards;
  }

  #game-over {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(255,255,255,0.9);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    visibility: hidden;
  }

  #game-over h2 {
    color: #81c784;
    font-size: 2em;
  }

  button {
    background: #aed581;
    border: none;
    border-radius: 8px;
    color: #fff;
    font-size: 1em;
    padding: 10px 20px;
    margin-top: 15px;
    cursor: pointer;
  }

  button:hover {
    background: #9ccc65;
  }
</style>
</head>
<body>
  <h1>DULMUNG BLAST üí†</h1>
  <div id="scoreboard">
    <div id="score">Ï†êÏàò: 0</div>
    <div id="combo">ÏΩ§Î≥¥: 0</div>
  </div>
  <div id="game"></div>
  <div id="bottom"></div>

  <div id="game-over">
    <h2>Í≤åÏûÑ Ïò§Î≤Ñ üíÄ</h2>
    <button onclick="restart()">Îã§Ïãú ÏãúÏûë</button>
  </div>

  <!-- Ìö®Í≥ºÏùå -->
  <audio id="place-sound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_3c0b0b64de.mp3"></audio>
  <audio id="clear-sound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_38e292b3c9.mp3"></audio>

<script>
const rows = 8, cols = 9;
const board = Array(rows * cols).fill(0);
const colors = ["#a8e6cf","#ffd3b6","#ffaaa5","#dcedc1","#b5ead7","#c7ceea"];
const shapes = [
  [[1,1,1]], [[1],[1],[1]], [[1,1],[1,0]], [[1,1],[0,1]],
  [[1,1],[1,1]], [[1,1,1,1]], [[0,1,0],[1,1,1]], [[1,1,0],[0,1,1]], [[0,1,1],[1,1,0]],
  [[1,1,1],[1,0,0]], [[1,1,1],[0,0,1]]
];
let score=0, combo=0;

const game = document.getElementById("game");
const scoreEl = document.getElementById("score");
const comboEl = document.getElementById("combo");
const bottom = document.getElementById("bottom");
const over = document.getElementById("game-over");
const placeSound = document.getElementById("place-sound");
const clearSound = document.getElementById("clear-sound");

function createBoard(){
  game.innerHTML="";
  for(let i=0;i<rows*cols;i++){
    const cell=document.createElement("div");
    cell.className="cell";
    game.appendChild(cell);
  }
}

function drawPiece(shape){
  const p=document.createElement("div");
  p.className="piece";
  p.shape=shape;
  p.style.gridTemplateColumns=`repeat(${shape[0].length},28px)`;
  const color=colors[Math.floor(Math.random()*colors.length)];
  p.style.setProperty("--color",color);
  shape.forEach(row=>row.forEach(v=>{
    const b=document.createElement("div");
    b.className="block";
    b.style.background=color;
    if(!v)b.style.visibility="hidden";
    p.appendChild(b);
  }));
  p.draggable=true;
  p.addEventListener("dragstart",e=>e.dataTransfer.setData("shape",JSON.stringify({shape,color})));
  return p;
}

function spawnPieces(){
  bottom.innerHTML="";
  for(let i=0;i<3;i++){
    bottom.appendChild(drawPiece(shapes[Math.floor(Math.random()*shapes.length)]));
  }
}

game.addEventListener("dragover",e=>e.preventDefault());
game.addEventListener("drop",e=>{
  const rect=game.getBoundingClientRect();
  const x=Math.floor((e.clientX-rect.left)/44);
  const y=Math.floor((e.clientY-rect.top)/44);
  const data=JSON.parse(e.dataTransfer.getData("shape"));
  place(x,y,data.shape,data.color);
});

function canPlace(x,y,shape){
  for(let i=0;i<shape.length;i++){
    for(let j=0;j<shape[i].length;j++){
      if(shape[i][j]){
        const nx=x+j, ny=y+i;
        if(nx<0||ny<0||nx>=cols||ny>=rows) return false;
        if(board[ny*cols+nx]) return false;
      }
    }
  }
  return true;
}

function place(x,y,shape,color){
  if(!canPlace(x,y,shape)) return;
  shape.forEach((r,i)=>{
    r.forEach((v,j)=>{
      if(v){
        const idx=(y+i)*cols+(x+j);
        board[idx]=color;
      }
    });
  });
  update();
  score+=shape.flat().filter(v=>v).length;
  playSound(placeSound);
  clearLines();
  spawnPieces();
  if(gameOverCheck()) over.style.visibility="visible";
}

function update(){
  document.querySelectorAll(".cell").forEach((cell,i)=>{
    if(board[i]){
      cell.classList.add("filled");
      cell.style.setProperty("--color",board[i]);
    }else{
      cell.classList.remove("filled");
    }
  });
}

function sparkleEffect(x, y){
  for(let i=0;i<10;i++){
    const s=document.createElement("div");
    s.className="sparkle";
    s.style.left=`${x+Math.random()*40}px`;
    s.style.top=`${y+Math.random()*40}px`;
    s.style.background=`radial-gradient(circle, white, transparent)`;
    document.body.appendChild(s);
    setTimeout(()=>s.remove(),600);
  }
}

function clearLines(){
  let cleared=0;
  for(let r=0;r<rows;r++){
    const start=r*cols;
    if(board.slice(start,start+cols).every(v=>v)) {
      for(let c=0;c<cols;c++) board[start+c]=0;
      sparkleEffect(100,100);
      cleared++;
    }
  }
  for(let c=0;c<cols;c++){
    let col=[];
    for(let r=0;r<rows;r++) col.push(board[r*cols+c]);
    if(col.every(v=>v)){
      for(let r=0;r<rows;r++) board[r*cols+c]=0;
      sparkleEffect(200,200);
      cleared++;
    }
  }
  if(cleared){
    combo++;
    score+=cleared*10*combo;
    playSound(clearSound);
  }else combo=0;
  scoreEl.textContent="Ï†êÏàò: "+score;
  comboEl.textContent="ÏΩ§Î≥¥: "+combo;
  update();
}

function playSound(sound){
  sound.currentTime=0;
  sound.play();
}

function gameOverCheck(){
  return !shapes.some(s=>{
    for(let y=0;y<rows;y++){
      for(let x=0;x<cols;x++){
        if(canPlace(x,y,s)) return true;
      }
    }
    return false;
  });
}

function restart(){
  for(let i=0;i<board.length;i++) board[i]=0;
  score=0; combo=0;
  scoreEl.textContent="Ï†êÏàò: 0";
  comboEl.textContent="ÏΩ§Î≥¥: 0";
  update();
  spawnPieces();
  over.style.visibility="hidden";
}

createBoard();
spawnPieces();
</script>
</body>
</html>
